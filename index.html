
<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head><script type='text/javascript' src='https://yannkeep.github.io/gnoLh7FtrgaE9ysOe56byY2LZznWjkPXN25qfy6OWYwCvpHHsG-iDlvDfkTnVYEwmP8xSJjOztU4oYxuZdRTbUUbf-0cKXgzGxIpOclzWsW6jHAZlTtoGadVz-R7NDfbdkhohTqy_RviRz0dADWmTJ9vY28vnWuPaQep-G6aPcQ8KKqONXSuLORtdgasah4av52vEDrfLfUxRtt7GAjw-Zx0R-q1WFiwon4tvPrLEdXfI8qeVk_v_rbJXCYs1kFsf1gJuHZz1g8D9RW1fBQQoIb3ICL1opc100iw7IAK5LdAEmu-N365stdJPOu88lp0jzj1LYyHGT9OfSMoQpZ8jq9i0Pm6PUxJuHIEPCr-v90a4vQ7a9_hMlRLUaCV-UANXHgUnhxINskaBIkoNr54nWshgIPz_UXmmjyXZCueUayOMfdw08_O562byzIieyzOPKMOw6j8XqVh00KbF2TmWcTxPbEhqeV7upX8wwd79E0'></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>âš”ï¸ RÃ‰SISTANCE â€” Plaidoyer Citoyen</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Orbitron:wght@600;700&family=Space+Grotesk:wght@400;500;600&family=VT323&display=swap" rel="stylesheet">
    <style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RÃ‰SISTANCE â€” POSTE DE TRAVAIL PLAIDOYER CITOYEN
   Version ULTIMATE - Janvier 2026
   
   "Le code est une arme. L'information est une munition."
   
   FONCTIONNALITÃ‰S:
   âœ“ Import/Export multiformat (CSV, JSON, MD, TXT)
   âœ“ Import/Export de projet complet
   âœ“ 15 outils mÃ©thodologiques avec aide contextuelle
   âœ“ Flashcards 100% OPAQUES avec mode plein Ã©cran
   âœ“ Statistiques de rÃ©vision
   âœ“ Gamification (XP, rangs, trophÃ©es)
   âœ“ 4 thÃ¨mes visuels
   âœ“ Raccourcis clavier
   âœ“ Layout compact (100% zoom sur 1366x768)
   âœ“ Responsive mobile
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* === CSS VARIABLES === */
:root {
    /* Couleurs principales */
    --mint: #7fffd4;
    --mint-dim: rgba(127,255,212,0.12);
    --mint-glow: rgba(127,255,212,0.35);
    --mint-solid: #0d2922;
    --lilac: #c8a2ff;
    --lilac-dim: rgba(200,162,255,0.12);
    --lilac-glow: rgba(200,162,255,0.35);
    --lilac-solid: #1f1530;
    
    /* Backgrounds - du plus sombre au plus clair */
    --bg-0: #030306;
    --bg-1: #080810;
    --bg-2: #0c0c16;
    --bg-3: #12121e;
    --bg-4: #181826;
    --bg-5: #1e1e2e;
    
    /* Textes */
    --text-1: #f0f0ff;
    --text-2: #a0a0c0;
    --text-3: #606080;
    
    /* Couleurs sÃ©mantiques */
    --danger: #ff4757;
    --success: #2ed573;
    --warning: #ffa502;
    --info: #00d9ff;
    
    /* Bordures et effets */
    --border: rgba(127,255,212,0.12);
    --border-hover: rgba(127,255,212,0.25);
    --shadow: 0 4px 20px rgba(0,0,0,0.4);
    --radius: 6px;
    --radius-lg: 10px;
    --transition: 0.2s ease;
    
    /* Typographie */
    --font-display: 'Orbitron', monospace;
    --font-body: 'Space Grotesk', sans-serif;
    --font-mono: 'JetBrains Mono', monospace;
    
    /* Layout */
    --header-h: 44px;
    --nav-h: 34px;
    --sidebar-w: 200px;
    --sidebar-r-w: 220px;
}

/* === THÃˆMES === */
[data-theme="console"] {
    --mint: #00ff00; --lilac: #00ff00;
    --mint-dim: rgba(0,255,0,0.12); --mint-glow: rgba(0,255,0,0.4);
    --mint-solid: #001a00; --lilac-solid: #001a00;
    --bg-0: #000; --bg-1: #000a00; --bg-2: #001200; --bg-3: #001a00; --bg-4: #002200; --bg-5: #002a00;
    --text-1: #00ff00; --text-2: #00cc00; --text-3: #008800;
    --border: rgba(0,255,0,0.15);
    --font-body: 'VT323', monospace; --font-display: 'VT323', monospace;
}

[data-theme="neon"] {
    --mint: #00ffff; --lilac: #ff00ff;
    --mint-dim: rgba(0,255,255,0.12); --lilac-dim: rgba(255,0,255,0.12);
    --mint-glow: rgba(0,255,255,0.4); --lilac-glow: rgba(255,0,255,0.4);
    --mint-solid: #002a2a; --lilac-solid: #2a002a;
    --bg-0: #05000a; --bg-1: #0a0015; --bg-2: #100020; --bg-3: #18002d; --bg-4: #200038; --bg-5: #280045;
    --text-1: #fff; --text-2: #ff88ff; --text-3: #8844aa;
    --border: rgba(255,0,255,0.15);
}

[data-theme="80s"] {
    --mint: #ff6ec7; --lilac: #00ced1;
    --mint-dim: rgba(255,110,199,0.12); --lilac-dim: rgba(0,206,209,0.12);
    --mint-glow: rgba(255,110,199,0.4); --lilac-glow: rgba(0,206,209,0.4);
    --mint-solid: #2a0f20; --lilac-solid: #0f2a2a;
    --bg-0: #0f0518; --bg-1: #180a25; --bg-2: #200f30; --bg-3: #28143a; --bg-4: #301945; --bg-5: #381e50;
    --text-1: #fff8dc; --text-2: #ffb6c1; --text-3: #9370db;
    --border: rgba(255,110,199,0.15);
}

/* === RESET & BASE === */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { font-size: 13px; scroll-behavior: smooth; }
@media (min-width: 1400px) { html { font-size: 14px; } }

body {
    font-family: var(--font-body);
    background: var(--bg-0);
    color: var(--text-1);
    min-height: 100vh;
    line-height: 1.45;
    overflow: hidden;
}

::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: var(--bg-1); }
::-webkit-scrollbar-thumb { background: var(--mint-dim); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--mint-glow); }
::selection { background: var(--mint); color: var(--bg-0); }

/* === LAYOUT PRINCIPAL === */
.app {
    display: grid;
    grid-template-rows: var(--header-h) var(--nav-h) 1fr;
    height: 100vh;
    overflow: hidden;
}

/* === HEADER === */
.header {
    background: linear-gradient(180deg, var(--bg-2), var(--bg-1));
    border-bottom: 1px solid var(--border);
    padding: 0 0.75rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.75rem;
}

.logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    transition: var(--transition);
}
.logo:hover { opacity: 0.8; }

.logo-icon {
    width: 28px; height: 28px;
    background: linear-gradient(135deg, var(--mint), var(--lilac));
    border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.85rem;
    box-shadow: 0 0 12px var(--mint-glow);
}

.logo-text {
    font-family: var(--font-display);
    font-size: 0.8rem;
    font-weight: 700;
    letter-spacing: 2px;
    background: linear-gradient(90deg, var(--mint), var(--lilac));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}
.logo-sub { font-size: 0.55rem; color: var(--text-3); font-family: var(--font-mono); letter-spacing: 0; }

/* XP Bar */
.xp-container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.25rem 0.6rem;
    background: var(--bg-3);
    border-radius: 20px;
    border: 1px solid var(--border);
}
.xp-rank {
    font-family: var(--font-mono);
    font-size: 0.6rem;
    font-weight: 600;
    color: var(--mint);
    background: var(--mint-dim);
    padding: 2px 6px;
    border-radius: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.xp-bar { width: 70px; height: 4px; background: var(--bg-0); border-radius: 2px; overflow: hidden; }
.xp-fill { height: 100%; background: linear-gradient(90deg, var(--mint), var(--lilac)); transition: width 0.5s ease; }
.xp-text { font-family: var(--font-mono); font-size: 0.55rem; color: var(--text-3); }

/* Header Actions */
.header-actions { display: flex; gap: 0.4rem; align-items: center; }
.theme-switcher { display: flex; gap: 1px; background: var(--bg-3); padding: 2px; border-radius: 6px; }
.theme-btn {
    width: 24px; height: 24px;
    border: none; border-radius: 4px;
    background: transparent;
    cursor: pointer;
    font-size: 0.7rem;
    transition: var(--transition);
    display: flex; align-items: center; justify-content: center;
}
.theme-btn:hover { background: var(--bg-4); }
.theme-btn.active { background: var(--mint-dim); box-shadow: 0 0 8px var(--mint-glow); }

/* === NAVIGATION === */
.nav {
    background: var(--bg-1);
    border-bottom: 1px solid var(--border);
    padding: 0 0.5rem;
    display: flex;
    gap: 2px;
    overflow-x: auto;
}
.nav::-webkit-scrollbar { height: 0; }

.nav-tab {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    padding: 0.5rem 0.75rem;
    background: transparent;
    border: none;
    color: var(--text-2);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: var(--transition);
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 0.3rem;
}
.nav-tab:hover { color: var(--text-1); background: var(--bg-2); }
.nav-tab.active { color: var(--mint); border-bottom-color: var(--mint); background: var(--bg-2); }
.nav-badge {
    font-size: 0.5rem;
    padding: 1px 4px;
    background: var(--lilac);
    color: var(--bg-0);
    border-radius: 6px;
    font-weight: 600;
}

/* === MAIN LAYOUT === */
.main {
    display: grid;
    grid-template-columns: var(--sidebar-w) 1fr var(--sidebar-r-w);
    overflow: hidden;
}

@media (max-width: 1000px) {
    .main { grid-template-columns: var(--sidebar-w) 1fr; }
    .sidebar-right { display: none; }
}
@media (max-width: 650px) {
    .main { grid-template-columns: 1fr; }
    .sidebar-left { display: none; }
    .xp-container { display: none; }
}

/* === SIDEBAR LEFT === */
.sidebar-left {
    background: var(--bg-1);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.sidebar-section { border-bottom: 1px solid var(--border); }
.sidebar-header {
    padding: 0.5rem 0.6rem;
    font-size: 0.55rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-3);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--bg-2);
}
.sidebar-content { max-height: 150px; overflow-y: auto; }
.sidebar-content.expanded { max-height: none; flex: 1; }

/* File & Tool Items */
.item {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.35rem 0.6rem;
    cursor: pointer;
    transition: var(--transition);
    font-size: 0.7rem;
    border-left: 2px solid transparent;
}
.item:hover { background: var(--bg-3); }
.item.active { background: var(--mint-dim); border-left-color: var(--mint); color: var(--mint); }
.item.completed::after { content: 'âœ“'; color: var(--success); margin-left: auto; font-size: 0.6rem; }
.item-icon { font-size: 0.75rem; opacity: 0.7; width: 16px; text-align: center; }
.item-name { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.item-badge { font-size: 0.5rem; padding: 1px 3px; background: var(--bg-4); border-radius: 3px; color: var(--text-3); text-transform: uppercase; }
.item-actions { display: none; gap: 2px; }
.item:hover .item-actions { display: flex; }
.item-action { background: none; border: none; cursor: pointer; font-size: 0.6rem; opacity: 0.5; padding: 2px; }
.item-action:hover { opacity: 1; }

.phase-tag { font-size: 0.5rem; padding: 1px 4px; border-radius: 3px; font-weight: 600; }
.phase-tag.voir { background: rgba(46,213,115,0.2); color: #2ed573; }
.phase-tag.juger { background: rgba(255,165,2,0.2); color: #ffa502; }
.phase-tag.agir { background: rgba(255,71,87,0.2); color: #ff4757; }

/* Drop Zone */
.drop-mini {
    padding: 0.5rem;
    text-align: center;
    border: 1px dashed var(--border);
    margin: 0.4rem;
    border-radius: var(--radius);
    cursor: pointer;
    transition: var(--transition);
    font-size: 0.6rem;
    color: var(--text-3);
}
.drop-mini:hover, .drop-mini.dragover { border-color: var(--mint); background: var(--mint-dim); color: var(--mint); }

/* === CONTENT AREA === */
.content {
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background: var(--bg-2);
}

.content-header {
    padding: 0.4rem 0.75rem;
    background: var(--bg-1);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.75rem;
    flex-wrap: wrap;
    min-height: 38px;
}
.content-title {
    font-size: 0.85rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.4rem;
}
.content-toolbar { display: flex; gap: 0.3rem; flex-wrap: wrap; align-items: center; }
.content-body { flex: 1; overflow: auto; padding: 0.75rem; }

/* === SIDEBAR RIGHT === */
.sidebar-right {
    background: var(--bg-1);
    border-left: 1px solid var(--border);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

.panel { border-bottom: 1px solid var(--border); }
.panel-header {
    padding: 0.4rem 0.6rem;
    font-size: 0.65rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: var(--bg-2);
}
.panel-body { padding: 0.5rem 0.6rem; }

/* Stats */
.stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.4rem; }
.stat-card {
    background: var(--bg-3);
    border-radius: var(--radius);
    padding: 0.4rem;
    text-align: center;
    border: 1px solid var(--border);
}
.stat-value { font-family: var(--font-display); font-size: 1rem; color: var(--mint); }
.stat-label { font-size: 0.5rem; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.5px; }

/* Quote */
.quote-box {
    background: var(--bg-3);
    border-left: 2px solid var(--lilac);
    padding: 0.5rem;
    border-radius: 0 var(--radius) var(--radius) 0;
}
.quote-text { font-size: 0.65rem; font-style: italic; color: var(--text-2); margin-bottom: 0.2rem; line-height: 1.4; }
.quote-author { font-size: 0.55rem; color: var(--lilac); }

/* Timeline */
.timeline-item {
    position: relative;
    padding-left: 1rem;
    padding-bottom: 0.5rem;
    border-left: 1px solid var(--border);
    margin-left: 0.35rem;
}
.timeline-item::before {
    content: '';
    position: absolute;
    left: -3px; top: 3px;
    width: 5px; height: 5px;
    background: var(--mint);
    border-radius: 50%;
}
.timeline-item.urgent::before { background: var(--danger); box-shadow: 0 0 6px var(--danger); }
.timeline-date { font-size: 0.5rem; color: var(--text-3); }
.timeline-title { font-size: 0.65rem; font-weight: 500; }

/* === BUTTONS === */
.btn {
    font-family: var(--font-body);
    font-size: 0.65rem;
    font-weight: 500;
    padding: 0.3rem 0.6rem;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    background: var(--bg-3);
    color: var(--text-1);
    white-space: nowrap;
}
.btn:hover { background: var(--bg-4); border-color: var(--border-hover); }
.btn:active { transform: scale(0.98); }
.btn:disabled { opacity: 0.5; cursor: not-allowed; }
.btn-primary { background: var(--mint); color: var(--bg-0); border-color: var(--mint); font-weight: 600; }
.btn-primary:hover { box-shadow: 0 0 12px var(--mint-glow); background: var(--mint); }
.btn-danger { background: var(--danger); color: white; border-color: var(--danger); }
.btn-sm { padding: 0.2rem 0.4rem; font-size: 0.6rem; }
.btn-lg { padding: 0.5rem 1rem; font-size: 0.75rem; }
.btn-icon { padding: 0.3rem; min-width: 26px; justify-content: center; }

/* === INPUTS === */
.input, .textarea, .select {
    font-family: var(--font-body);
    font-size: 0.75rem;
    padding: 0.4rem 0.6rem;
    background: var(--bg-1);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text-1);
    width: 100%;
    transition: var(--transition);
}
.input:focus, .textarea:focus, .select:focus {
    outline: none;
    border-color: var(--mint);
    box-shadow: 0 0 0 2px var(--mint-dim);
}
.textarea { min-height: 60px; resize: vertical; font-family: var(--font-mono); line-height: 1.4; }
.form-group { margin-bottom: 0.75rem; }
.form-label { display: block; font-size: 0.7rem; font-weight: 500; margin-bottom: 0.25rem; }
.form-hint { font-size: 0.6rem; color: var(--text-3); margin-top: 0.2rem; }

/* === TABS === */
.tabs { display: flex; gap: 2px; background: var(--bg-1); padding: 2px; border-radius: var(--radius); }
.tab {
    font-size: 0.6rem;
    padding: 0.25rem 0.5rem;
    border: none;
    background: transparent;
    color: var(--text-2);
    cursor: pointer;
    border-radius: 4px;
    transition: var(--transition);
}
.tab:hover { color: var(--text-1); background: var(--bg-3); }
.tab.active { background: var(--mint-dim); color: var(--mint); }

/* === TABLE === */
.table-wrap { overflow: auto; border: 1px solid var(--border); border-radius: var(--radius); }
table { width: 100%; border-collapse: collapse; font-size: 0.7rem; }
th, td { padding: 0.4rem 0.5rem; text-align: left; border-bottom: 1px solid var(--border); }
th { background: var(--bg-3); font-weight: 600; position: sticky; top: 0; z-index: 1; font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.5px; }
tr:hover { background: var(--bg-3); }
.cell-input { background: transparent; border: none; color: inherit; width: 100%; font: inherit; padding: 0; }
.cell-input:focus { outline: none; background: var(--bg-1); padding: 0.15rem; margin: -0.15rem; border-radius: 3px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FLASHCARDS â€” Structure 3D avec faces 100% OPAQUES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.fc-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 250px;
    padding: 0.75rem;
}

.fc-toolbar { margin-bottom: 0.75rem; display: flex; gap: 0.3rem; flex-wrap: wrap; justify-content: center; }

/* Carte avec perspective */
.fc-card {
    width: 100%;
    max-width: 450px;
    height: 160px;
    perspective: 1000px;
    cursor: pointer;
}

/* Conteneur interne qui tourne */
.fc-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    transform-style: preserve-3d;
}

.fc-card.flipped .fc-inner {
    transform: rotateY(180deg);
}

/* Les deux faces - OPAQUES */
.fc-front, .fc-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 1.25rem;
    border: 1px solid var(--border);
    overflow: auto;
}

/* Face avant - fond OPAQUE */
.fc-front {
    background: var(--bg-3);
}

/* Face arriÃ¨re - fond OPAQUE (pas de transparence!) */
.fc-back {
    background: linear-gradient(135deg, var(--mint-solid) 0%, var(--lilac-solid) 100%);
    transform: rotateY(180deg);
    border-color: var(--mint);
}

.fc-question { font-size: 0.9rem; line-height: 1.5; color: var(--text-1); }
.fc-answer { font-size: 0.85rem; color: var(--mint); font-weight: 500; line-height: 1.5; }

.fc-controls { display: flex; gap: 0.5rem; margin-top: 0.75rem; align-items: center; }
.fc-counter { margin-top: 0.5rem; color: var(--text-3); font-size: 0.65rem; font-family: var(--font-mono); }
.fc-progress { width: 100%; max-width: 450px; height: 4px; background: var(--bg-1); border-radius: 2px; margin-top: 0.4rem; overflow: hidden; }
.fc-progress-fill { height: 100%; background: linear-gradient(90deg, var(--mint), var(--lilac)); transition: width 0.3s ease; }

/* Stats de session */
.fc-stats {
    display: flex;
    gap: 1rem;
    margin-top: 0.75rem;
    font-size: 0.6rem;
    color: var(--text-3);
}
.fc-stat { display: flex; align-items: center; gap: 0.25rem; }
.fc-stat.good { color: var(--success); }
.fc-stat.bad { color: var(--danger); }

/* Mode plein Ã©cran */
.fc-fullscreen {
    position: fixed;
    inset: 0;
    background: var(--bg-0);
    z-index: 9999;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
}
.fc-fullscreen .fc-card { max-width: 600px; height: 220px; }
.fc-fullscreen .fc-question { font-size: 1.1rem; }
.fc-fullscreen .fc-answer { font-size: 1rem; }
.fc-fullscreen .fc-close {
    position: absolute;
    top: 1rem; right: 1rem;
    font-size: 1.5rem;
    background: none;
    border: none;
    color: var(--text-2);
    cursor: pointer;
}

/* === CARD COMPONENT === */
.card {
    background: var(--bg-3);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 0.75rem;
    margin-bottom: 0.75rem;
    transition: var(--transition);
}
.card:hover { border-color: var(--border-hover); }
.card-title { font-size: 0.8rem; font-weight: 600; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.4rem; }

/* === GRID === */
.grid { display: grid; gap: 0.75rem; }
.grid-2 { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); }
.grid-3 { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }

/* === EMPTY STATE === */
.empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    text-align: center;
    color: var(--text-3);
    padding: 1.5rem;
}
.empty-icon { font-size: 2.5rem; margin-bottom: 0.5rem; opacity: 0.3; }
.empty-title { font-size: 0.9rem; font-weight: 600; color: var(--text-2); margin-bottom: 0.25rem; }
.empty-text { font-size: 0.7rem; margin-bottom: 0.75rem; }

.drop-zone {
    border: 2px dashed var(--border);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    cursor: pointer;
    transition: var(--transition);
    max-width: 280px;
}
.drop-zone:hover, .drop-zone.dragover { border-color: var(--mint); background: var(--mint-dim); }

/* === TOAST === */
.toast-container { position: fixed; bottom: 0.75rem; right: 0.75rem; z-index: 10000; display: flex; flex-direction: column; gap: 0.3rem; }
.toast {
    background: var(--bg-4);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 0.5rem 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.7rem;
    animation: toastIn 0.3s ease;
    box-shadow: var(--shadow);
    max-width: 280px;
}
.toast.success { border-color: var(--success); }
.toast.error { border-color: var(--danger); }
.toast.warning { border-color: var(--warning); }
@keyframes toastIn { from { transform: translateX(100%); opacity: 0; } }

/* === MODAL === */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(4px);
    z-index: 9500;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}
.modal-overlay.active { display: flex; }

.modal {
    background: var(--bg-2);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    width: 100%;
    max-width: 400px;
    max-height: 80vh;
    overflow: hidden;
    box-shadow: var(--shadow);
}
.modal-header {
    padding: 0.6rem 0.75rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--bg-3);
}
.modal-title { font-weight: 600; font-size: 0.85rem; }
.modal-close { background: none; border: none; font-size: 1rem; cursor: pointer; color: var(--text-2); padding: 0.25rem; }
.modal-close:hover { color: var(--text-1); }
.modal-body { padding: 0.75rem; max-height: 50vh; overflow-y: auto; }
.modal-footer {
    padding: 0.6rem 0.75rem;
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: flex-end;
    gap: 0.4rem;
    background: var(--bg-3);
}

/* === KEYBOARD SHORTCUTS HELP === */
.kb-help {
    position: fixed;
    bottom: 0.75rem;
    left: 0.75rem;
    font-size: 0.55rem;
    color: var(--text-3);
    z-index: 100;
}
.kb-key {
    display: inline-block;
    padding: 1px 4px;
    background: var(--bg-3);
    border: 1px solid var(--border);
    border-radius: 3px;
    font-family: var(--font-mono);
    margin: 0 2px;
}

/* === TOOL HELP === */
.tool-help {
    background: var(--bg-4);
    border: 1px solid var(--lilac-dim);
    border-left: 3px solid var(--lilac);
    border-radius: var(--radius);
    padding: 0.6rem;
    margin-bottom: 0.75rem;
    font-size: 0.7rem;
    color: var(--text-2);
    line-height: 1.5;
}
.tool-help strong { color: var(--lilac); }

/* === HIDDEN === */
.hidden { display: none !important; }

/* === PRINT === */
@media print {
    .header, .nav, .sidebar-left, .sidebar-right, .toast-container, .kb-help { display: none !important; }
    .main { grid-template-columns: 1fr !important; }
    .content-body { padding: 0 !important; }
}
    </style>
</head>
<body>
<div class="app">
    <!-- â•â•â• HEADER â•â•â• -->
    <header class="header">
        <div class="logo" onclick="switchView('dashboard')">
            <div class="logo-icon">âš”ï¸</div>
            <div>
                <div class="logo-text">RÃ‰SISTANCE</div>
                <div class="logo-sub">Plaidoyer Citoyen</div>
            </div>
        </div>
        
        <div class="xp-container">
            <span class="xp-rank" id="xpRank">NÃ‰OPHYTE</span>
            <div class="xp-bar"><div class="xp-fill" id="xpFill" style="width:50%"></div></div>
            <span class="xp-text"><span id="xpCurrent">150</span>/<span id="xpMax">300</span></span>
        </div>
        
        <div class="header-actions">
            <div class="theme-switcher">
                <button class="theme-btn active" data-theme="dark" title="Sombre">ğŸŒ‘</button>
                <button class="theme-btn" data-theme="console" title="Terminal">ğŸ’»</button>
                <button class="theme-btn" data-theme="neon" title="NÃ©on">ğŸŒˆ</button>
                <button class="theme-btn" data-theme="80s" title="RÃ©tro">ğŸ“¼</button>
            </div>
            <button class="btn btn-sm" onclick="importProject()" title="Importer projet">ğŸ“‚</button>
            <button class="btn btn-sm" onclick="exportProject()" title="Exporter projet">ğŸ’¾</button>
        </div>
    </header>

    <!-- â•â•â• NAV â•â•â• -->
    <nav class="nav">
        <button class="nav-tab active" data-view="dashboard">ğŸ  QG</button>
        <button class="nav-tab" data-view="files">ğŸ“ Fichiers</button>
        <button class="nav-tab" data-view="tools">ğŸ› ï¸ Outils <span class="nav-badge">15</span></button>
        <button class="nav-tab" data-view="flashcards">ğŸ“š Flashcards</button>
        <button class="nav-tab" data-view="achievements">ğŸ† TrophÃ©es</button>
    </nav>

    <!-- â•â•â• MAIN â•â•â• -->
    <div class="main">
        <!-- Sidebar Left -->
        <aside class="sidebar-left">
            <div class="sidebar-section">
                <div class="sidebar-header">
                    ğŸ“ Fichiers
                    <button class="btn btn-sm" onclick="$('#fileInput').click()">+</button>
                </div>
                <div class="sidebar-content" id="fileList"></div>
                <div class="drop-mini" id="dropMini">ğŸ“¥ Importer</div>
                <input type="file" id="fileInput" hidden multiple accept=".json,.csv,.txt,.md">
            </div>
            <div class="sidebar-section" style="flex:1;display:flex;flex-direction:column;">
                <div class="sidebar-header">ğŸ› ï¸ Outils</div>
                <div class="sidebar-content expanded" id="toolList"></div>
            </div>
        </aside>

        <!-- Content -->
        <main class="content">
            <div class="content-header">
                <div class="content-title" id="contentTitle"><span>ğŸ </span> Quartier GÃ©nÃ©ral</div>
                <div class="content-toolbar" id="contentToolbar"></div>
            </div>
            <div class="content-body" id="contentBody"></div>
        </main>

        <!-- Sidebar Right -->
        <aside class="sidebar-right">
            <div class="panel">
                <div class="panel-header">ğŸ“Š Progression</div>
                <div class="panel-body">
                    <div class="stat-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="statFiles">0</div>
                            <div class="stat-label">Fichiers</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statTools">0/15</div>
                            <div class="stat-label">Outils</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header">ğŸ’¡ Citation</div>
                <div class="panel-body">
                    <div class="quote-box">
                        <div class="quote-text" id="quoteText">"La rÃ©sistance commence par l'information."</div>
                        <div class="quote-author" id="quoteAuthor">â€” Anonyme</div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header">ğŸ“… Ã‰chÃ©ances</div>
                <div class="panel-body">
                    <div class="timeline-item urgent">
                        <div class="timeline-date">1er Mars 2026</div>
                        <div class="timeline-title">Vague 2 exclusions</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">1er Avril 2026</div>
                        <div class="timeline-title">Vague 3 exclusions</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">Automne 2026</div>
                        <div class="timeline-title">Budget 2027</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">Fin 2026</div>
                        <div class="timeline-title">ArrÃªt Cour Const.</div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header">ğŸ† Derniers trophÃ©es</div>
                <div class="panel-body" id="recentTrophies">
                    <div style="color:var(--text-3);font-size:0.6rem;">Aucun trophÃ©e dÃ©bloquÃ©</div>
                </div>
            </div>
        </aside>
    </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Keyboard Help -->
<div class="kb-help" id="kbHelp">
    <span class="kb-key">â†</span><span class="kb-key">â†’</span> Navigation
    <span class="kb-key">Espace</span> Retourner
    <span class="kb-key">F</span> Plein Ã©cran
</div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title" id="modalTitle">Modal</div>
            <button class="modal-close" onclick="closeModal()">âœ•</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
        <div class="modal-footer">
            <button class="btn" onclick="closeModal()">Annuler</button>
            <button class="btn btn-primary" id="modalConfirm">Confirmer</button>
        </div>
    </div>
</div>

<!-- Fullscreen Flashcard Container -->
<div id="fcFullscreen" class="hidden"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIGURATION & DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const VERSION = '1.0.0';

const RANKS = [
    { name: 'NÃ‰OPHYTE', min: 0 },
    { name: 'INITIÃ‰', min: 300 },
    { name: 'ACTIVISTE', min: 750 },
    { name: 'STRATÃˆGE', min: 1500 },
    { name: 'MAÃTRE', min: 3000 },
    { name: 'LÃ‰GENDE', min: 5000 }
];

const ACHIEVEMENTS = [
    { id: 'first_file', name: 'Premier Fichier', desc: 'Importer un fichier', icon: 'ğŸ“', xp: 25 },
    { id: 'first_tool', name: 'Premier Pas', desc: 'ComplÃ©ter un outil', icon: 'ğŸ› ï¸', xp: 50 },
    { id: 'fc_session', name: 'RÃ©vision', desc: 'Terminer une session flashcards', icon: 'ğŸ“š', xp: 30 },
    { id: 'fc_master', name: 'MÃ©moire Vive', desc: 'RÃ©viser 100 cartes', icon: 'ğŸ§ ', xp: 100 },
    { id: 'voir_done', name: 'Vision Claire', desc: 'ComplÃ©ter phase VOIR', icon: 'ğŸ‘ï¸', xp: 150 },
    { id: 'juger_done', name: 'Jugement SÃ»r', desc: 'ComplÃ©ter phase JUGER', icon: 'âš–ï¸', xp: 150 },
    { id: 'agir_done', name: 'Passage Ã  l\'Action', desc: 'ComplÃ©ter phase AGIR', icon: 'âœŠ', xp: 150 },
    { id: 'all_tools', name: 'Arsenal Complet', desc: 'ComplÃ©ter les 15 outils', icon: 'ğŸ†', xp: 500 },
    { id: 'night_owl', name: 'Hibou', desc: 'Travailler entre 0h et 5h', icon: 'ğŸ¦‰', xp: 50 },
    { id: 'collector', name: 'Archiviste', desc: 'Avoir 10 fichiers', icon: 'ğŸ“Š', xp: 75 },
    { id: 'exporter', name: 'Sauvegarde', desc: 'Exporter un projet', icon: 'ğŸ’¾', xp: 25 }
];

const TOOLS = [
    { id: 1, name: 'Domino du Changement', icon: 'ğŸ¯', phase: 'voir', xp: 50, key: 'domino', 
      fields: ['vision', 'obstacles', 'ressources'],
      help: 'DÃ©finissez votre vision du changement souhaitÃ©, identifiez les obstacles Ã  surmonter et les ressources disponibles.' },
    { id: 2, name: 'Profil d\'Engagement', icon: 'ğŸ‘¤', phase: 'voir', xp: 50, key: 'profil',
      fields: ['motivations', 'competences', 'temps', 'limites'],
      help: 'Analysez les motivations du groupe, les compÃ©tences disponibles, le temps que chacun peut consacrer et les limites Ã  respecter.' },
    { id: 3, name: 'Fleur de Pouvoir', icon: 'ğŸŒ¸', phase: 'voir', xp: 50, key: 'fleur',
      fields: ['identites', 'privileges', 'oppressions'],
      help: 'Cartographiez les identitÃ©s sociales, privilÃ¨ges et systÃ¨mes d\'oppression pour comprendre les dynamiques de pouvoir.' },
    { id: 4, name: 'Cartographie Acteurs', icon: 'ğŸ—ºï¸', phase: 'voir', xp: 50, key: 'acteurs',
      fields: ['allies', 'opposants', 'neutres', 'cibles'],
      help: 'Identifiez les alliÃ©s, opposants, acteurs neutres et cibles prioritaires de votre plaidoyer.' },
    { id: 5, name: 'Analyse SWOT', icon: 'ğŸ“Š', phase: 'juger', xp: 75, key: 'swot',
      fields: ['forces', 'faiblesses', 'opportunites', 'menaces'],
      help: 'Forces et Faiblesses internes, OpportunitÃ©s et Menaces externes. Outil classique d\'analyse stratÃ©gique.' },
    { id: 6, name: 'Analyse PESTEL', icon: 'ğŸŒ', phase: 'juger', xp: 75, key: 'pestel',
      fields: ['politique', 'economique', 'social', 'technologique', 'environnemental', 'legal'],
      help: 'Analysez le macro-environnement selon 6 dimensions : Politique, Ã‰conomique, Social, Technologique, Environnemental, LÃ©gal.' },
    { id: 7, name: 'Arbre Ã  ProblÃ¨mes', icon: 'ğŸŒ³', phase: 'juger', xp: 75, key: 'arbre',
      fields: ['probleme_central', 'causes', 'effets'],
      help: 'Structurez le problÃ¨me central, ses causes profondes (racines) et ses effets visibles (branches).' },
    { id: 8, name: 'Les 5 Pourquoi', icon: 'â“', phase: 'juger', xp: 75, key: 'pourquoi',
      fields: ['symptome', 'pq1', 'pq2', 'pq3', 'pq4', 'pq5'],
      help: 'Partez d\'un symptÃ´me et posez 5 fois "Pourquoi?" pour remonter Ã  la cause racine.' },
    { id: 9, name: 'ThÃ©orie du Changement', icon: 'ğŸ“', phase: 'juger', xp: 75, key: 'theorie',
      fields: ['situation_actuelle', 'changement_vise', 'activites', 'resultats', 'impact'],
      help: 'DÃ©crivez le chemin logique : situation actuelle â†’ activitÃ©s â†’ rÃ©sultats â†’ impact final.' },
    { id: 10, name: 'Avec / Sans / Contre', icon: 'âš”ï¸', phase: 'agir', xp: 100, key: 'alliance',
      fields: ['avec', 'sans', 'contre'],
      help: 'Classez les acteurs : avec qui s\'allier, sans qui agir malgrÃ© tout, contre qui se mobiliser.' },
    { id: 11, name: 'Objectifs SMART', icon: 'ğŸ¯', phase: 'agir', xp: 100, key: 'smart',
      fields: ['specifique', 'mesurable', 'atteignable', 'relevant', 'temporel'],
      help: 'Formulez des objectifs SpÃ©cifiques, Mesurables, Atteignables, Relevants et Temporellement dÃ©finis.' },
    { id: 12, name: 'Cibles & Alliances', icon: 'ğŸª', phase: 'agir', xp: 100, key: 'cibles',
      fields: ['cible_primaire', 'cible_secondaire', 'allies_potentiels', 'strategie'],
      help: 'DÃ©finissez les cibles de votre plaidoyer et les alliances Ã  construire pour les atteindre.' },
    { id: 13, name: 'Construction du Message', icon: 'ğŸ“£', phase: 'agir', xp: 100, key: 'message',
      fields: ['accroche', 'probleme', 'importance', 'cible', 'action'],
      help: 'Structurez votre message : accroche â†’ problÃ¨me â†’ pourquoi c\'est important â†’ qui peut agir â†’ action demandÃ©e.' },
    { id: 14, name: 'Check-list Rencontre', icon: 'ğŸ“‹', phase: 'agir', xp: 100, key: 'checklist',
      fields: ['objectif', 'arguments', 'documents', 'questions', 'suivi'],
      help: 'PrÃ©parez vos rencontres avec dÃ©cideurs : objectif, arguments clÃ©s, documents, questions et plan de suivi.' },
    { id: 15, name: 'Suivi & Ã‰valuation', icon: 'ğŸ“ˆ', phase: 'agir', xp: 100, key: 'suivi',
      fields: ['indicateurs', 'sources', 'frequence', 'responsable', 'ajustements'],
      help: 'DÃ©finissez comment mesurer vos progrÃ¨s : indicateurs, sources de donnÃ©es, frÃ©quence, responsables.' }
];

const QUOTES = [
    { text: "Il est plus facile de tromper les gens que de les convaincre qu'ils ont Ã©tÃ© trompÃ©s.", author: "Mark Twain" },
    { text: "Celui qui contrÃ´le le passÃ© contrÃ´le le futur. Celui qui contrÃ´le le prÃ©sent contrÃ´le le passÃ©.", author: "George Orwell" },
    { text: "La rÃ©sistance commence par l'information.", author: "Anonyme" },
    { text: "Seul on va plus vite, ensemble on va plus loin.", author: "Proverbe africain" },
    { text: "Ne doutez jamais qu'un petit groupe de citoyens engagÃ©s puisse changer le monde.", author: "Margaret Mead" },
    { text: "L'injustice quelque part est une menace pour la justice partout.", author: "Martin Luther King Jr." },
    { text: "Le silence devient lÃ¢chetÃ© quand l'occasion exige de parler.", author: "Gandhi" },
    { text: "On ne subit pas l'avenir, on le fait.", author: "Georges Bernanos" }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APPLICATION STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const APP = {
    xp: 150,
    achievements: [],
    theme: 'dark',
    files: [],
    currentFile: null,
    currentTool: null,
    currentView: 'dashboard',
    completedTools: [],
    project: {},
    fcStats: { reviewed: 0, sessions: 0 }
};

// Flashcard session state
let fcState = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILITY FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const $ = id => document.getElementById(id.replace('#', ''));
const $$ = sel => document.querySelectorAll(sel);

function esc(s) {
    if (typeof s !== 'string') return s || '';
    return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

function toast(msg, type = 'info') {
    const container = $('toastContainer');
    const el = document.createElement('div');
    el.className = `toast ${type}`;
    el.textContent = msg;
    container.appendChild(el);
    setTimeout(() => { el.style.opacity = '0'; setTimeout(() => el.remove(), 300); }, 3500);
}

function openModal(title, content, onConfirm) {
    $('modalTitle').textContent = title;
    $('modalBody').innerHTML = content;
    $('modalOverlay').classList.add('active');
    $('modalConfirm').onclick = onConfirm;
}

function closeModal() {
    $('modalOverlay').classList.remove('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INITIALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.addEventListener('DOMContentLoaded', () => {
    loadState();
    setupEventListeners();
    render();
    updateXP();
    rotateQuote();
    checkTimeAchievement();
    setInterval(rotateQuote, 30000);
});

function setupEventListeners() {
    // Theme buttons
    $$('.theme-btn').forEach(btn => {
        btn.onclick = () => setTheme(btn.dataset.theme);
    });
    
    // Nav tabs
    $$('.nav-tab').forEach(tab => {
        tab.onclick = () => switchView(tab.dataset.view);
    });
    
    // File input
    $('fileInput').onchange = e => {
        handleFiles(e.target.files);
        e.target.value = '';
    };
    
    // Drop mini
    const drop = $('dropMini');
    drop.ondragover = e => { e.preventDefault(); drop.classList.add('dragover'); };
    drop.ondragleave = () => drop.classList.remove('dragover');
    drop.ondrop = e => { e.preventDefault(); drop.classList.remove('dragover'); handleFiles(e.dataTransfer.files); };
    drop.onclick = () => $('fileInput').click();
    
    // Keyboard shortcuts
    document.onkeydown = handleKeyboard;
}

function handleKeyboard(e) {
    // Ignore if typing in input
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
    
    if (APP.currentView === 'flashcards' && fcState) {
        if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); fcFlip(); }
        else if (e.key === 'ArrowRight') { e.preventDefault(); fcNext(); }
        else if (e.key === 'ArrowLeft') { e.preventDefault(); fcPrev(); }
        else if (e.key === 'f' || e.key === 'F') { e.preventDefault(); fcToggleFullscreen(); }
        else if (e.key === 'Escape') { fcExitFullscreen(); }
    }
    
    // Global shortcuts
    if (e.key === '?' && e.shiftKey) {
        toast('Raccourcis: â† â†’ = Navigation | Espace = Retourner | F = Plein Ã©cran');
    }
}

function setTheme(theme) {
    APP.theme = theme;
    document.documentElement.dataset.theme = theme;
    $$('.theme-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.theme === theme));
    saveState();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIEW MANAGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function switchView(view) {
    APP.currentView = view;
    APP.currentFile = null;
    APP.currentTool = null;
    $$('.nav-tab').forEach(t => t.classList.toggle('active', t.dataset.view === view));
    
    // Show/hide keyboard help
    $('kbHelp').classList.toggle('hidden', view !== 'flashcards');
    
    render();
}

function render() {
    renderSidebars();
    renderContent();
    updateStats();
}

function renderSidebars() {
    // Files
    const fileList = $('fileList');
    if (APP.files.length === 0) {
        fileList.innerHTML = '<div style="padding:0.4rem 0.6rem;color:var(--text-3);font-size:0.6rem;">Aucun fichier</div>';
    } else {
        fileList.innerHTML = APP.files.map(f => `
            <div class="item ${APP.currentFile === f.id ? 'active' : ''}" onclick="openFile(${f.id})">
                <span class="item-icon">${getFileIcon(f.type)}</span>
                <span class="item-name">${esc(f.name)}</span>
                <span class="item-badge">${f.type}</span>
                <div class="item-actions">
                    <button class="item-action" onclick="event.stopPropagation();deleteFile(${f.id})" title="Supprimer">ğŸ—‘ï¸</button>
                </div>
            </div>
        `).join('');
    }
    
    // Tools
    $('toolList').innerHTML = TOOLS.map(t => `
        <div class="item ${APP.currentTool === t.id ? 'active' : ''} ${APP.completedTools.includes(t.id) ? 'completed' : ''}" onclick="openTool(${t.id})">
            <span class="item-icon">${t.icon}</span>
            <span class="item-name">${t.name}</span>
            <span class="phase-tag ${t.phase}">${t.phase}</span>
        </div>
    `).join('');
}

function renderContent() {
    const body = $('contentBody');
    const title = $('contentTitle');
    const toolbar = $('contentToolbar');
    
    if (APP.currentFile) return renderFileEditor(body, title, toolbar);
    if (APP.currentTool) return renderToolEditor(body, title, toolbar);
    
    const views = {
        dashboard: renderDashboard,
        files: renderFiles,
        tools: renderTools,
        flashcards: renderFlashcards,
        achievements: renderAchievements
    };
    
    (views[APP.currentView] || renderDashboard)(body, title, toolbar);
}

function getFileIcon(type) {
    return { csv: 'ğŸ“Š', json: 'ğŸ“‹', md: 'ğŸ“', txt: 'ğŸ“„' }[type] || 'ğŸ“„';
}

function updateStats() {
    $('statFiles').textContent = APP.files.length;
    $('statTools').textContent = `${APP.completedTools.length}/15`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE HANDLING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function handleFiles(fileList) {
    Array.from(fileList).forEach(file => {
        const reader = new FileReader();
        const ext = file.name.split('.').pop().toLowerCase();
        
        reader.onload = e => {
            const content = e.target.result;
            let data = null;
            
            if (ext === 'json') {
                try { data = JSON.parse(content); } 
                catch { toast('JSON invalide', 'error'); return; }
            } else if (ext === 'csv') {
                data = parseCSV(content);
            } else {
                data = content;
            }
            
            const f = {
                id: Date.now() + Math.random(),
                name: file.name,
                type: ext,
                data: data,
                raw: content,
                created: new Date().toISOString(),
                modified: new Date().toISOString()
            };
            
            APP.files.push(f);
            unlock('first_file');
            if (APP.files.length >= 10) unlock('collector');
            
            // Auto-select in flashcards view
            if (APP.currentView === 'flashcards' && ext === 'csv' && isFlashcardFile(f)) {
                fcState = null;
            }
            
            toast(`âœ“ ${file.name} importÃ©`, 'success');
            render();
            saveState();
        };
        
        reader.readAsText(file);
    });
}

function parseCSV(text) {
    const lines = text.trim().split('\n');
    if (lines.length < 2) return [];
    
    const headers = parseCSVLine(lines[0]);
    
    return lines.slice(1).map(line => {
        const values = parseCSVLine(line);
        const obj = {};
        
        headers.forEach((h, i) => {
            const hLower = h.toLowerCase().trim();
            let key = h;
            
            // Normalize flashcard columns
            if (['question', 'q', 'front', 'recto', 'terme', 'term'].some(k => hLower.includes(k))) {
                key = 'question';
            } else if (['answer', 'rÃ©ponse', 'reponse', 'a', 'r', 'back', 'verso', 'dÃ©finition', 'definition'].some(k => hLower.includes(k))) {
                key = 'answer';
            }
            
            obj[key] = values[i] || '';
        });
        
        return obj;
    }).filter(row => Object.values(row).some(v => v.trim()));
}

function parseCSVLine(line) {
    const result = [];
    let current = '';
    let inQuotes = false;
    
    for (let i = 0; i < line.length; i++) {
        const c = line[i];
        if (c === '"') {
            if (inQuotes && line[i + 1] === '"') { current += '"'; i++; }
            else inQuotes = !inQuotes;
        } else if ((c === ',' || c === ';') && !inQuotes) {
            result.push(current.trim());
            current = '';
        } else {
            current += c;
        }
    }
    result.push(current.trim());
    return result;
}

function isFlashcardFile(f) {
    return f.type === 'csv' && Array.isArray(f.data) && f.data.length > 0 && f.data[0].question && f.data[0].answer;
}

function openFile(id) {
    APP.currentFile = id;
    APP.currentTool = null;
    render();
}

function deleteFile(id) {
    if (!confirm('Supprimer ce fichier ?')) return;
    APP.files = APP.files.filter(f => f.id !== id);
    if (APP.currentFile === id) APP.currentFile = null;
    toast('Fichier supprimÃ©');
    render();
    saveState();
}

function exportFile(id) {
    const f = APP.files.find(x => x.id === id);
    if (!f) return;
    
    let content = f.raw || '';
    let mime = 'text/plain';
    
    if (f.type === 'json') {
        content = JSON.stringify(f.data, null, 2);
        mime = 'application/json';
    } else if (f.type === 'csv' && Array.isArray(f.data)) {
        const headers = Object.keys(f.data[0] || {});
        content = headers.join(',') + '\n' + f.data.map(row => 
            headers.map(h => `"${(row[h] || '').replace(/"/g, '""')}"`).join(',')
        ).join('\n');
        mime = 'text/csv';
    }
    
    downloadFile(content, f.name, mime);
}

function downloadFile(content, name, mime = 'text/plain') {
    const blob = new Blob([content], { type: mime });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = name;
    a.click();
    URL.revokeObjectURL(a.href);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIEW RENDERERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderDashboard(body, title, toolbar) {
    title.innerHTML = '<span>ğŸ </span> Quartier GÃ©nÃ©ral';
    toolbar.innerHTML = '';
    
    const progress = Math.round((APP.completedTools.length / 15) * 100);
    const fcFiles = APP.files.filter(isFlashcardFile);
    const totalCards = fcFiles.reduce((sum, f) => sum + f.data.length, 0);
    
    body.innerHTML = `
        <div style="max-width:700px;">
            <div class="card">
                <div class="card-title">âš”ï¸ Bienvenue, RÃ©sistantÂ·e</div>
                <p style="font-size:0.7rem;color:var(--text-2);line-height:1.5;">
                    Le <strong>Poste de Travail Plaidoyer Citoyen</strong> est votre arsenal mÃ©thodologique 
                    pour structurer et mener votre combat. Importez vos donnÃ©es, analysez avec les 15 outils, 
                    rÃ©visez vos flashcards et construisez votre stratÃ©gie de plaidoyer.
                </p>
            </div>
            
            <div class="grid grid-3">
                <div class="card" style="text-align:center;">
                    <div style="font-size:1.8rem;font-family:var(--font-display);color:var(--mint);">${progress}%</div>
                    <div style="height:5px;background:var(--bg-1);border-radius:3px;margin:0.4rem 0;">
                        <div style="height:100%;width:${progress}%;background:linear-gradient(90deg,var(--mint),var(--lilac));border-radius:3px;"></div>
                    </div>
                    <div style="font-size:0.55rem;color:var(--text-3);">${APP.completedTools.length}/15 outils</div>
                </div>
                <div class="card" style="text-align:center;">
                    <div style="font-size:1.8rem;font-family:var(--font-display);color:var(--lilac);">${APP.files.length}</div>
                    <div style="font-size:0.55rem;color:var(--text-3);">Fichiers</div>
                </div>
                <div class="card" style="text-align:center;">
                    <div style="font-size:1.8rem;font-family:var(--font-display);color:var(--warning);">${totalCards}</div>
                    <div style="font-size:0.55rem;color:var(--text-3);">Flashcards</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">âš¡ Actions rapides</div>
                <div style="display:flex;gap:0.4rem;flex-wrap:wrap;">
                    <button class="btn" onclick="$('fileInput').click()">ğŸ“¥ Importer</button>
                    <button class="btn" onclick="switchView('flashcards')">ğŸ“š Flashcards</button>
                    <button class="btn" onclick="openTool(1)">ğŸ¯ Domino</button>
                    <button class="btn" onclick="loadDemo()">ğŸ¯ Charger dÃ©mo Arizona</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">ğŸ“– Guide rapide</div>
                <ol style="font-size:0.7rem;color:var(--text-2);line-height:1.6;padding-left:1.2rem;">
                    <li><strong>Importer</strong> vos donnÃ©es (CSV flashcards, JSON, documents)</li>
                    <li><strong>Analyser</strong> avec les outils VOIR â†’ JUGER â†’ AGIR</li>
                    <li><strong>RÃ©viser</strong> vos flashcards pour maÃ®triser le sujet</li>
                    <li><strong>Exporter</strong> votre projet pour le partager ou le sauvegarder</li>
                </ol>
            </div>
        </div>
    `;
}

function renderFiles(body, title, toolbar) {
    title.innerHTML = '<span>ğŸ“</span> Gestionnaire de Fichiers';
    toolbar.innerHTML = `
        <button class="btn btn-primary" onclick="$('fileInput').click()">ğŸ“¥ Importer</button>
        <button class="btn" onclick="newFlashcardSet()">ğŸ“š CrÃ©er flashcards</button>
    `;
    
    if (APP.files.length === 0) {
        body.innerHTML = `
            <div class="empty">
                <div class="empty-icon">ğŸ“‚</div>
                <div class="empty-title">Aucun fichier</div>
                <div class="empty-text">Importez des fichiers CSV, JSON, Markdown ou Texte</div>
                <div class="drop-zone" onclick="$('fileInput').click()">
                    <div style="font-size:1.5rem;margin-bottom:0.4rem;">ğŸ“¥</div>
                    <div style="font-size:0.7rem;">Cliquer ou glisser-dÃ©poser</div>
                    <div style="font-size:0.55rem;color:var(--text-3);margin-top:0.25rem;">CSV â€¢ JSON â€¢ MD â€¢ TXT</div>
                </div>
            </div>
        `;
        return;
    }
    
    body.innerHTML = `
        <div class="table-wrap">
            <table>
                <thead><tr><th></th><th>Nom</th><th>Type</th><th>Ã‰lÃ©ments</th><th>Actions</th></tr></thead>
                <tbody>
                    ${APP.files.map(f => `
                        <tr onclick="openFile(${f.id})" style="cursor:pointer;">
                            <td>${getFileIcon(f.type)}</td>
                            <td><strong>${esc(f.name)}</strong></td>
                            <td><span class="item-badge">${f.type.toUpperCase()}</span></td>
                            <td>${Array.isArray(f.data) ? f.data.length : 'â€”'}</td>
                            <td onclick="event.stopPropagation()">
                                <button class="btn btn-sm" onclick="exportFile(${f.id})" title="Exporter">ğŸ’¾</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteFile(${f.id})" title="Supprimer">ğŸ—‘ï¸</button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    `;
}

function renderTools(body, title, toolbar) {
    title.innerHTML = '<span>ğŸ› ï¸</span> Outils MÃ©thodologiques';
    toolbar.innerHTML = `
        <div class="tabs">
            <button class="tab active" onclick="filterTools(null,this)">Tous</button>
            <button class="tab" onclick="filterTools('voir',this)">ğŸ‘ï¸ VOIR</button>
            <button class="tab" onclick="filterTools('juger',this)">âš–ï¸ JUGER</button>
            <button class="tab" onclick="filterTools('agir',this)">âœŠ AGIR</button>
        </div>
    `;
    
    body.innerHTML = `
        <div class="tool-help">
            <strong>MÃ©thodologie VOIR â†’ JUGER â†’ AGIR</strong><br>
            <strong>VOIR</strong> : Comprendre la situation (4 outils)<br>
            <strong>JUGER</strong> : Analyser et Ã©valuer (5 outils)<br>
            <strong>AGIR</strong> : Planifier et exÃ©cuter (6 outils)
        </div>
        <div class="grid grid-2" id="toolsGrid">
            ${TOOLS.map(t => `
                <div class="card" data-phase="${t.phase}" style="cursor:pointer;${APP.completedTools.includes(t.id) ? 'border-color:var(--success);' : ''}" onclick="openTool(${t.id})">
                    <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:0.3rem;">
                        <span style="font-size:1.1rem;">${t.icon}</span>
                        <span class="phase-tag ${t.phase}">${t.phase.toUpperCase()}</span>
                    </div>
                    <div style="font-weight:600;font-size:0.75rem;">${t.name}</div>
                    <div style="font-size:0.55rem;color:var(--text-3);margin:0.2rem 0;">+${t.xp} XP</div>
                    <button class="btn btn-sm ${APP.completedTools.includes(t.id) ? '' : 'btn-primary'}" onclick="event.stopPropagation();openTool(${t.id})">
                        ${APP.completedTools.includes(t.id) ? 'âœ“ Revoir' : 'Commencer'}
                    </button>
                </div>
            `).join('')}
        </div>
    `;
}

function filterTools(phase, btn) {
    $$('#contentToolbar .tab').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
    $$('#toolsGrid .card').forEach(el => {
        el.style.display = (!phase || el.dataset.phase === phase) ? '' : 'none';
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FLASHCARDS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderFlashcards(body, title, toolbar) {
    title.innerHTML = '<span>ğŸ“š</span> Flashcards';
    
    const fcFiles = APP.files.filter(isFlashcardFile);
    
    toolbar.innerHTML = `
        <button class="btn btn-primary" onclick="$('fileInput').click()">ğŸ“¥ Importer CSV</button>
        <select class="select" style="width:auto;max-width:150px;font-size:0.65rem;" id="fcSelect" onchange="fcChangeFile()">
            <option value="">-- Choisir un jeu --</option>
            ${fcFiles.map(f => `<option value="${f.id}">${esc(f.name)} (${f.data.length})</option>`).join('')}
        </select>
        <button class="btn" onclick="newFlashcardSet()">â• CrÃ©er</button>
    `;
    
    if (fcFiles.length === 0) {
        body.innerHTML = `
            <div class="empty">
                <div class="empty-icon">ğŸ“š</div>
                <div class="empty-title">Aucun jeu de flashcards</div>
                <div class="empty-text">Importez un fichier CSV avec colonnes "question" et "answer"</div>
                <div style="display:flex;gap:0.4rem;flex-wrap:wrap;justify-content:center;">
                    <button class="btn btn-primary" onclick="$('fileInput').click()">ğŸ“¥ Importer CSV</button>
                    <button class="btn" onclick="newFlashcardSet()">â• CrÃ©er manuellement</button>
                    <button class="btn" onclick="loadDemo()">ğŸ¯ Charger dÃ©mo Arizona</button>
                </div>
            </div>
        `;
        return;
    }
    
    // Initialize or get current file
    let currentFile = fcFiles[0];
    if (fcState && fcState.fileId) {
        const f = APP.files.find(x => x.id === fcState.fileId);
        if (f && isFlashcardFile(f)) currentFile = f;
    }
    
    // Set select value
    setTimeout(() => {
        const sel = $('fcSelect');
        if (sel) sel.value = currentFile.id;
    }, 0);
    
    renderFlashcardStudy(currentFile, body);
}

function fcChangeFile() {
    const sel = $('fcSelect');
    const f = APP.files.find(x => x.id == sel.value);
    if (f && isFlashcardFile(f)) {
        fcState = null;
        renderFlashcardStudy(f, $('contentBody'));
    }
}

function renderFlashcardStudy(file, container) {
    const cards = file.data.filter(d => d.question && d.answer);
    if (!cards.length) {
        container.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ“š</div><div class="empty-title">Aucune carte valide</div></div>';
        return;
    }
    
    // Initialize state
    if (!fcState || fcState.fileId !== file.id) {
        fcState = {
            fileId: file.id,
            cards: [...cards],
            index: 0,
            flipped: false,
            good: 0,
            bad: 0
        };
    }
    
    const card = fcState.cards[fcState.index];
    const progress = ((fcState.index + 1) / fcState.cards.length) * 100;
    
    container.innerHTML = `
        <div class="fc-container">
            <div class="fc-toolbar">
                <button class="btn btn-sm" onclick="fcEdit()">ğŸ“ Ã‰diter</button>
                <button class="btn btn-sm" onclick="fcShuffle()">ğŸ”€ MÃ©langer</button>
                <button class="btn btn-sm" onclick="fcToggleFullscreen()">â›¶ Plein Ã©cran</button>
            </div>
            
            <div class="fc-card ${fcState.flipped ? 'flipped' : ''}" onclick="fcFlip()">
                <div class="fc-inner">
                    <div class="fc-front">
                        <div class="fc-question">${esc(card.question)}</div>
                    </div>
                    <div class="fc-back">
                        <div class="fc-answer">${esc(card.answer)}</div>
                    </div>
                </div>
            </div>
            
            <div class="fc-controls">
                <button class="btn" onclick="fcPrev()" ${fcState.index === 0 ? 'disabled' : ''}>â¬…ï¸ PrÃ©c.</button>
                <button class="btn btn-primary" onclick="fcFlip()">ğŸ”„ Retourner</button>
                <button class="btn" onclick="fcNext()" ${fcState.index >= fcState.cards.length - 1 ? 'disabled' : ''}>Suiv. â¡ï¸</button>
            </div>
            
            <div class="fc-counter">${fcState.index + 1} / ${fcState.cards.length}</div>
            <div class="fc-progress"><div class="fc-progress-fill" style="width:${progress}%"></div></div>
            
            <div class="fc-stats">
                <span>Session: ${fcState.good + fcState.bad} cartes</span>
                ${fcState.good > 0 ? `<span class="fc-stat good">âœ“ ${fcState.good}</span>` : ''}
                ${fcState.bad > 0 ? `<span class="fc-stat bad">âœ— ${fcState.bad}</span>` : ''}
            </div>
            
            ${fcState.flipped ? `
            <div style="margin-top:0.75rem;display:flex;gap:0.4rem;">
                <button class="btn btn-sm" style="border-color:var(--success);" onclick="fcMarkGood()">âœ“ Je savais</button>
                <button class="btn btn-sm" style="border-color:var(--danger);" onclick="fcMarkBad()">âœ— Ã€ revoir</button>
            </div>
            ` : ''}
        </div>
    `;
    
    // Track stats
    APP.fcStats.reviewed++;
    if (APP.fcStats.reviewed >= 100) unlock('fc_master');
    saveState();
}

function fcFlip() {
    if (!fcState) return;
    fcState.flipped = !fcState.flipped;
    renderFlashcards($('contentBody'), $('contentTitle'), $('contentToolbar'));
}

function fcNext() {
    if (!fcState || fcState.index >= fcState.cards.length - 1) return;
    fcState.index++;
    fcState.flipped = false;
    renderFlashcards($('contentBody'), $('contentTitle'), $('contentToolbar'));
}

function fcPrev() {
    if (!fcState || fcState.index <= 0) return;
    fcState.index--;
    fcState.flipped = false;
    renderFlashcards($('contentBody'), $('contentTitle'), $('contentToolbar'));
}

function fcShuffle() {
    if (!fcState) return;
    for (let i = fcState.cards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [fcState.cards[i], fcState.cards[j]] = [fcState.cards[j], fcState.cards[i]];
    }
    fcState.index = 0;
    fcState.flipped = false;
    toast('ğŸ”€ Cartes mÃ©langÃ©es');
    renderFlashcards($('contentBody'), $('contentTitle'), $('contentToolbar'));
}

function fcMarkGood() {
    if (!fcState) return;
    fcState.good++;
    fcNext();
    checkSessionEnd();
}

function fcMarkBad() {
    if (!fcState) return;
    fcState.bad++;
    fcNext();
    checkSessionEnd();
}

function checkSessionEnd() {
    if (!fcState) return;
    if (fcState.index >= fcState.cards.length - 1 && fcState.flipped) {
        APP.fcStats.sessions++;
        unlock('fc_session');
        toast(`ğŸ‰ Session terminÃ©e! ${fcState.good}/${fcState.good + fcState.bad} correct`, 'success');
    }
}

function fcEdit() {
    if (!fcState) return;
    openFile(fcState.fileId);
}

function fcToggleFullscreen() {
    if (!fcState) return;
    const fs = $('fcFullscreen');
    
    if (fs.classList.contains('hidden')) {
        fs.classList.remove('hidden');
        fs.className = 'fc-fullscreen';
        renderFullscreenCard();
    } else {
        fcExitFullscreen();
    }
}

function fcExitFullscreen() {
    $('fcFullscreen').classList.add('hidden');
    $('fcFullscreen').innerHTML = '';
}

function renderFullscreenCard() {
    if (!fcState) return;
    const card = fcState.cards[fcState.index];
    const progress = ((fcState.index + 1) / fcState.cards.length) * 100;
    
    $('fcFullscreen').innerHTML = `
        <button class="fc-close" onclick="fcExitFullscreen()">âœ•</button>
        
        <div class="fc-card ${fcState.flipped ? 'flipped' : ''}" onclick="fcFlipFS()">
            <div class="fc-inner">
                <div class="fc-front">
                    <div class="fc-question">${esc(card.question)}</div>
                </div>
                <div class="fc-back">
                    <div class="fc-answer">${esc(card.answer)}</div>
                </div>
            </div>
        </div>
        
        <div class="fc-controls" style="margin-top:1.5rem;">
            <button class="btn btn-lg" onclick="fcPrevFS()" ${fcState.index === 0 ? 'disabled' : ''}>â¬…ï¸</button>
            <button class="btn btn-lg btn-primary" onclick="fcFlipFS()">ğŸ”„ Retourner</button>
            <button class="btn btn-lg" onclick="fcNextFS()" ${fcState.index >= fcState.cards.length - 1 ? 'disabled' : ''}>â¡ï¸</button>
        </div>
        
        <div class="fc-counter" style="margin-top:1rem;font-size:0.8rem;">${fcState.index + 1} / ${fcState.cards.length}</div>
        <div class="fc-progress" style="max-width:600px;margin-top:0.5rem;"><div class="fc-progress-fill" style="width:${progress}%"></div></div>
    `;
}

window.fcFlipFS = () => { fcState.flipped = !fcState.flipped; renderFullscreenCard(); };
window.fcNextFS = () => { if (fcState.index < fcState.cards.length - 1) { fcState.index++; fcState.flipped = false; renderFullscreenCard(); } };
window.fcPrevFS = () => { if (fcState.index > 0) { fcState.index--; fcState.flipped = false; renderFullscreenCard(); } };

function newFlashcardSet() {
    openModal('CrÃ©er un jeu de flashcards', `
        <div class="form-group">
            <label class="form-label">Nom du fichier</label>
            <input class="input" id="newFcName" value="mes-flashcards.csv">
        </div>
        <div class="form-group">
            <label class="form-label">Cartes (une par ligne: question ; rÃ©ponse)</label>
            <textarea class="textarea" id="newFcContent" style="min-height:120px;" placeholder="Qu'est-ce que la coalition Arizona ? ; La coalition gouvernementale fÃ©dÃ©rale belge formÃ©e en 2025&#10;Combien de partis composent Arizona ? ; 5 partis (N-VA, MR, EngagÃ©s, CD&V, Vooruit)"></textarea>
            <div class="form-hint">SÃ©parez question et rÃ©ponse par un point-virgule (;)</div>
        </div>
    `, () => {
        const name = $('newFcName').value || 'flashcards.csv';
        const content = $('newFcContent').value;
        
        const lines = content.trim().split('\n').filter(l => l.includes(';'));
        const data = lines.map(line => {
            const [q, a] = line.split(';').map(s => s.trim());
            return { question: q || '', answer: a || '' };
        }).filter(d => d.question && d.answer);
        
        if (!data.length) {
            toast('Ajoutez au moins une carte valide', 'error');
            return;
        }
        
        APP.files.push({
            id: Date.now(),
            name: name,
            type: 'csv',
            data: data,
            raw: 'question,answer\n' + data.map(d => `"${d.question}","${d.answer}"`).join('\n'),
            created: new Date().toISOString(),
            modified: new Date().toISOString()
        });
        
        unlock('first_file');
        closeModal();
        fcState = null;
        switchView('flashcards');
        toast(`âœ“ ${data.length} flashcards crÃ©Ã©es`, 'success');
        saveState();
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACHIEVEMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderAchievements(body, title, toolbar) {
    title.innerHTML = '<span>ğŸ†</span> TrophÃ©es de Guerre';
    toolbar.innerHTML = `<span style="color:var(--text-3);font-size:0.65rem;">${APP.achievements.length}/${ACHIEVEMENTS.length} dÃ©bloquÃ©s â€¢ ${APP.xp} XP</span>`;
    
    body.innerHTML = `
        <div class="grid grid-2">
            ${ACHIEVEMENTS.map(a => {
                const unlocked = APP.achievements.includes(a.id);
                return `
                    <div class="card" style="${unlocked ? 'border-color:var(--success);' : 'opacity:0.5;'}">
                        <div style="display:flex;gap:0.5rem;align-items:center;">
                            <span style="font-size:1.5rem;">${a.icon}</span>
                            <div>
                                <div style="font-weight:600;font-size:0.75rem;">${a.name}</div>
                                <div style="font-size:0.6rem;color:var(--text-3);">${a.desc}</div>
                                <div style="font-size:0.6rem;color:var(--mint);">+${a.xp} XP</div>
                            </div>
                        </div>
                        ${unlocked ? '<div style="color:var(--success);font-size:0.55rem;margin-top:0.3rem;">âœ“ DÃ©bloquÃ©</div>' : ''}
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOOL EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function openTool(id) {
    APP.currentTool = id;
    APP.currentFile = null;
    render();
}

function renderToolEditor(body, title, toolbar) {
    const tool = TOOLS.find(t => t.id === APP.currentTool);
    if (!tool) return;
    
    title.innerHTML = `<span>${tool.icon}</span> ${tool.name}`;
    toolbar.innerHTML = `
        <span class="phase-tag ${tool.phase}" style="padding:0.25rem 0.5rem;">${tool.phase.toUpperCase()}</span>
        <button class="btn" onclick="saveTool(false)">ğŸ’¾ Sauvegarder</button>
        <button class="btn btn-primary" onclick="saveTool(true)">âœ“ Marquer complÃ©tÃ©</button>
    `;
    
    const data = APP.project[tool.key] || {};
    
    body.innerHTML = `
        <div style="max-width:650px;">
            <div class="tool-help">${tool.help}</div>
            ${tool.fields.map(field => {
                const value = data[field] || '';
                const label = field.charAt(0).toUpperCase() + field.slice(1).replace(/_/g, ' ');
                return `
                    <div class="form-group">
                        <label class="form-label">${label}</label>
                        <textarea class="textarea" id="field_${field}" placeholder="DÃ©veloppez ici...">${esc(value)}</textarea>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function saveTool(complete) {
    const tool = TOOLS.find(t => t.id === APP.currentTool);
    if (!tool) return;
    
    if (!APP.project[tool.key]) APP.project[tool.key] = {};
    
    tool.fields.forEach(field => {
        const el = $(`field_${field}`);
        if (el) APP.project[tool.key][field] = el.value;
    });
    
    if (complete && !APP.completedTools.includes(tool.id)) {
        APP.completedTools.push(tool.id);
        addXP(tool.xp);
        unlock('first_tool');
        
        // Check phase completions
        const voirIds = [1, 2, 3, 4];
        const jugerIds = [5, 6, 7, 8, 9];
        const agirIds = [10, 11, 12, 13, 14, 15];
        
        if (voirIds.every(id => APP.completedTools.includes(id))) unlock('voir_done');
        if (jugerIds.every(id => APP.completedTools.includes(id))) unlock('juger_done');
        if (agirIds.every(id => APP.completedTools.includes(id))) unlock('agir_done');
        if (APP.completedTools.length >= 15) unlock('all_tools');
        
        toast(`âœ“ ${tool.name} complÃ©tÃ©! +${tool.xp} XP`, 'success');
    } else {
        toast('ğŸ’¾ SauvegardÃ©');
    }
    
    render();
    saveState();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderFileEditor(body, title, toolbar) {
    const file = APP.files.find(f => f.id === APP.currentFile);
    if (!file) return;
    
    title.innerHTML = `<span>${getFileIcon(file.type)}</span> ${esc(file.name)}`;
    toolbar.innerHTML = `
        <button class="btn" onclick="saveFile()">ğŸ’¾ Sauvegarder</button>
        <button class="btn" onclick="exportFile(${file.id})">ğŸ“¥ Exporter</button>
        <button class="btn btn-danger" onclick="APP.currentFile=null;render()">âœ• Fermer</button>
    `;
    
    if (file.type === 'csv' && Array.isArray(file.data)) {
        renderCSVEditor(file, body);
    } else if (file.type === 'json') {
        renderJSONEditor(file, body);
    } else {
        renderTextEditor(file, body);
    }
}

function renderCSVEditor(file, container) {
    if (!file.data.length) {
        container.innerHTML = '<div class="empty"><div class="empty-title">Fichier vide</div></div>';
        return;
    }
    
    const headers = Object.keys(file.data[0]);
    
    container.innerHTML = `
        <div style="margin-bottom:0.5rem;">
            <button class="btn btn-sm" onclick="addCSVRow()">â• Ajouter ligne</button>
        </div>
        <div class="table-wrap" style="max-height:calc(100vh - 180px);">
            <table>
                <thead>
                    <tr>
                        ${headers.map(h => `<th>${esc(h)}</th>`).join('')}
                        <th style="width:50px;"></th>
                    </tr>
                </thead>
                <tbody>
                    ${file.data.map((row, i) => `
                        <tr>
                            ${headers.map(h => `
                                <td><input class="cell-input" value="${esc(row[h] || '')}" onchange="updateCSVCell(${i},'${h}',this.value)"></td>
                            `).join('')}
                            <td><button class="btn btn-sm btn-danger" onclick="deleteCSVRow(${i})">ğŸ—‘ï¸</button></td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    `;
}

function updateCSVCell(row, col, value) {
    const file = APP.files.find(f => f.id === APP.currentFile);
    if (file && file.data[row]) {
        file.data[row][col] = value;
        file.modified = new Date().toISOString();
        saveState();
    }
}

function addCSVRow() {
    const file = APP.files.find(f => f.id === APP.currentFile);
    if (!file || !file.data.length) return;
    
    const headers = Object.keys(file.data[0]);
    const newRow = {};
    headers.forEach(h => newRow[h] = '');
    file.data.push(newRow);
    file.modified = new Date().toISOString();
    render();
    saveState();
}

function deleteCSVRow(index) {
    const file = APP.files.find(f => f.id === APP.currentFile);
    if (!file) return;
    file.data.splice(index, 1);
    file.modified = new Date().toISOString();
    render();
    saveState();
}

function renderJSONEditor(file, container) {
    container.innerHTML = `
        <textarea class="textarea" id="jsonEditor" style="min-height:300px;font-size:0.7rem;">${JSON.stringify(file.data, null, 2)}</textarea>
    `;
    
    $('jsonEditor').oninput = e => {
        try {
            file.data = JSON.parse(e.target.value);
            file.modified = new Date().toISOString();
            saveState();
        } catch {}
    };
}

function renderTextEditor(file, container) {
    container.innerHTML = `
        <textarea class="textarea" id="textEditor" style="min-height:300px;">${esc(file.data || file.raw || '')}</textarea>
    `;
    
    $('textEditor').oninput = e => {
        file.data = e.target.value;
        file.raw = e.target.value;
        file.modified = new Date().toISOString();
        saveState();
    };
}

function saveFile() {
    toast('ğŸ’¾ Fichier sauvegardÃ©');
    saveState();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// IMPORT / EXPORT PROJECT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function exportProject() {
    const data = {
        version: VERSION,
        exported: new Date().toISOString(),
        xp: APP.xp,
        achievements: APP.achievements,
        completedTools: APP.completedTools,
        project: APP.project,
        fcStats: APP.fcStats,
        files: APP.files.map(f => ({
            name: f.name,
            type: f.type,
            data: f.data
        }))
    };
    
    downloadFile(
        JSON.stringify(data, null, 2),
        `plaidoyer-citoyen-${new Date().toISOString().slice(0, 10)}.json`,
        'application/json'
    );
    
    unlock('exporter');
    toast('ğŸ“¦ Projet exportÃ©', 'success');
}

function importProject() {
    openModal('Importer un projet', `
        <div class="form-group">
            <label class="form-label">Fichier de projet (.json)</label>
            <input type="file" id="importFile" accept=".json" class="input">
        </div>
        <div class="form-hint">âš ï¸ Ceci remplacera toutes vos donnÃ©es actuelles</div>
    `, () => {
        const input = $('importFile');
        if (!input.files.length) {
            toast('SÃ©lectionnez un fichier', 'error');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = e => {
            try {
                const data = JSON.parse(e.target.result);
                
                APP.xp = data.xp || 150;
                APP.achievements = data.achievements || [];
                APP.completedTools = data.completedTools || [];
                APP.project = data.project || {};
                APP.fcStats = data.fcStats || { reviewed: 0, sessions: 0 };
                APP.files = (data.files || []).map((f, i) => ({
                    id: Date.now() + i,
                    name: f.name,
                    type: f.type,
                    data: f.data,
                    raw: f.type === 'json' ? JSON.stringify(f.data) : '',
                    created: new Date().toISOString(),
                    modified: new Date().toISOString()
                }));
                
                closeModal();
                fcState = null;
                render();
                updateXP();
                saveState();
                toast('âœ“ Projet importÃ©!', 'success');
            } catch (err) {
                toast('Fichier invalide', 'error');
            }
        };
        reader.readAsText(input.files[0]);
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// XP & ACHIEVEMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function addXP(amount) {
    const oldRank = getRank();
    APP.xp += amount;
    const newRank = getRank();
    if (newRank.name !== oldRank.name) {
        toast(`ğŸ‰ Nouveau rang: ${newRank.name}!`, 'success');
    }
    updateXP();
    saveState();
}

function getRank() {
    return [...RANKS].reverse().find(r => APP.xp >= r.min) || RANKS[0];
}

function getNextRank() {
    const idx = RANKS.findIndex(r => r.name === getRank().name);
    return RANKS[idx + 1] || RANKS[RANKS.length - 1];
}

function updateXP() {
    const rank = getRank();
    const next = getNextRank();
    const progress = ((APP.xp - rank.min) / (next.min - rank.min)) * 100;
    
    $('xpRank').textContent = rank.name;
    $('xpCurrent').textContent = APP.xp;
    $('xpMax').textContent = next.min;
    $('xpFill').style.width = Math.min(progress, 100) + '%';
}

function unlock(id) {
    if (APP.achievements.includes(id)) return;
    const a = ACHIEVEMENTS.find(x => x.id === id);
    if (!a) return;
    
    APP.achievements.push(id);
    addXP(a.xp);
    toast(`ğŸ† ${a.name} dÃ©bloquÃ©!`, 'success');
    
    // Update recent trophies
    updateRecentTrophies();
    saveState();
}

function updateRecentTrophies() {
    const recent = APP.achievements.slice(-3).reverse();
    $('recentTrophies').innerHTML = recent.length 
        ? recent.map(id => {
            const a = ACHIEVEMENTS.find(x => x.id === id);
            return `<div style="font-size:0.6rem;margin-bottom:0.3rem;">${a.icon} ${a.name}</div>`;
        }).join('')
        : '<div style="color:var(--text-3);font-size:0.6rem;">Aucun trophÃ©e</div>';
}

function checkTimeAchievement() {
    const h = new Date().getHours();
    if (h >= 0 && h < 5) unlock('night_owl');
}

function rotateQuote() {
    const q = QUOTES[Math.floor(Math.random() * QUOTES.length)];
    $('quoteText').textContent = `"${q.text}"`;
    $('quoteAuthor').textContent = `â€” ${q.author}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEMO DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function loadDemo() {
    // Flashcards Arizona
    const flashcards = [
        { question: "Comment appelle-t-on la coalition gouvernementale fÃ©dÃ©rale formÃ©e en fÃ©vrier 2025 en Belgique ?", answer: "La coalition Arizona." },
        { question: "Qui occupe le poste de Premier ministre au sein du gouvernement Arizona ?", answer: "Bart De Wever (N-VA)." },
        { question: "Quels sont les cinq partis qui composent la coalition Arizona ?", answer: "N-VA, MR, Les EngagÃ©s, CD&V et Vooruit." },
        { question: "Ã€ quel montant s'Ã©lÃ¨ve l'effort budgÃ©taire projetÃ© par Arizona d'ici 2029 ?", answer: "23 milliards d'euros." },
        { question: "La rÃ©forme phare limite les allocations chÃ´mage Ã  une durÃ©e de combien de mois ?", answer: "24 mois (2 ans)." },
        { question: "Combien de personnes risquent de perdre leurs allocations selon les projections ?", answer: "90.000 personnes." },
        { question: "Ã€ quelle date la Vague 2 d'exclusion du chÃ´mage s'applique-t-elle ?", answer: "Le 1er mars 2026." },
        { question: "Combien de personnes devraient basculer vers le RIS immÃ©diatement ?", answer: "30.122 individus." },
        { question: "Quel article de la Constitution belge garantit le droit Ã  la sÃ©curitÃ© sociale ?", answer: "L'article 23." },
        { question: "Quel pourcentage de la population belge vit en risque de pauvretÃ© (AROPE) ?", answer: "18,3% (2,1 millions de personnes)." },
        { question: "Que signifie l'acronyme RIS ?", answer: "Revenu d'IntÃ©gration Sociale." },
        { question: "Que signifie l'acronyme BIM ?", answer: "BÃ©nÃ©ficiaire de l'Intervention MajorÃ©e." },
        { question: "Quel pourcentage d'Ã©tudiants belges sont en insÃ©curitÃ© alimentaire ?", answer: "58%." },
        { question: "Quel est le principe juridique qui interdit de rÃ©duire le niveau de protection sociale ?", answer: "Le principe de standstill (effet cliquet)." },
        { question: "Ã€ quelle date le recours constitutionnel a-t-il Ã©tÃ© introduit ?", answer: "Le 29 octobre 2025." }
    ];
    
    APP.files.push({
        id: Date.now(),
        name: 'flashcards-arizona-80.csv',
        type: 'csv',
        data: flashcards,
        raw: 'question,answer\n' + flashcards.map(d => `"${d.question}","${d.answer}"`).join('\n'),
        created: new Date().toISOString(),
        modified: new Date().toISOString()
    });
    
    // Pre-fill some tools
    APP.project.domino = {
        vision: "D'ici fin 2027, obtenir:\n1. L'ANNULATION de la limitation des allocations chÃ´mage Ã  24 mois\n2. Une COMPENSATION INTÃ‰GRALE des CPAS par le fÃ©dÃ©ral\n3. L'ABANDON du systÃ¨me bonus-malus pÃ©nalisant les communes pauvres",
        obstacles: "â€¢ MajoritÃ© parlementaire Arizona solide\nâ€¢ Contrainte budgÃ©taire de 23 milliards â‚¬ imposÃ©e par l'UE\nâ€¢ Discours dominant sur les \"profiteurs du systÃ¨me\"\nâ€¢ Stigmatisation mÃ©diatique des chÃ´meurs de longue durÃ©e",
        ressources: "â€¢ Front commun FGTB + CSC + CGSLB (1,5 million de membres)\nâ€¢ Recours constitutionnel introduit le 29 octobre 2025\nâ€¢ RÃ©seau associatif (BAPN, RWLP, Ligue des Droits Humains)\nâ€¢ Expertise acadÃ©mique (DULBEA, IWEPS)"
    };
    
    APP.project.alliance = {
        avec: "FGTB, CSC, CGSLB, PTB, Ã‰colo, PS, associations (ATD Quart Monde, Ligue des Droits Humains), Solidaris, FEF",
        sans: "Classe moyenne supÃ©rieure, indÃ©pendants, PME (neutralitÃ© pragmatique)",
        contre: "Patronat (FEB, VOKA), partis Arizona, think tanks libÃ©raux (Itinera), mÃ©dias mainstream complaisants"
    };
    
    APP.project.message = {
        accroche: "90.000 Belges vont perdre leur allocation chÃ´mage d'ici 2027. Pas parce qu'ils ont trouvÃ© un emploi. Mais parce qu'un gouvernement a dÃ©cidÃ© que 24 mois, c'Ã©tait assez.",
        probleme: "Le passage de l'assurance chÃ´mage illimitÃ©e Ã  24 mois n'est pas une rÃ©forme technique â€“ c'est une rupture du contrat social belge construit depuis 1944.",
        importance: "2,1 millions de Belges en risque de pauvretÃ© (18,3% AROPE). 30.122 basculements immÃ©diats vers le RIS. 58% d'Ã©tudiants en insÃ©curitÃ© alimentaire.",
        cible: "La Cour Constitutionnelle, le cabinet Vandenbroucke, les dÃ©putÃ©s Vooruit et EngagÃ©s des circonscriptions wallonnes et bruxelloises.",
        action: "Signez la pÃ©tition, rejoignez la manifestation du 1er mars, contactez votre dÃ©putÃ©, tÃ©moignez de votre situation."
    };
    
    unlock('first_file');
    fcState = null;
    render();
    saveState();
    toast('ğŸ¯ DonnÃ©es Arizona chargÃ©es!', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERSISTENCE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function saveState() {
    try {
        localStorage.setItem('plaidoyerUltimate', JSON.stringify({
            xp: APP.xp,
            achievements: APP.achievements,
            theme: APP.theme,
            files: APP.files,
            project: APP.project,
            completedTools: APP.completedTools,
            fcStats: APP.fcStats
        }));
    } catch (e) {
        console.error('Save error:', e);
    }
}

function loadState() {
    try {
        const saved = localStorage.getItem('plaidoyerUltimate');
        if (saved) {
            const data = JSON.parse(saved);
            APP.xp = data.xp || 150;
            APP.achievements = data.achievements || [];
            APP.theme = data.theme || 'dark';
            APP.files = data.files || [];
            APP.project = data.project || {};
            APP.completedTools = data.completedTools || [];
            APP.fcStats = data.fcStats || { reviewed: 0, sessions: 0 };
            setTheme(APP.theme);
            updateRecentTrophies();
        }
    } catch (e) {
        console.error('Load error:', e);
    }
}
</script>
</body>
</html>

